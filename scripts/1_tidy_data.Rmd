---
title: "tidy_data"
output: html_document
---

#libraries
```{r}

library(tidyverse)
library(janitor)
library(here)
library(countrycode)


```


#Seafood production data

Capture fisheries data
```{r}
#Sort the symbols in values out
## "..." = data unavailable (here taken as zero)
## " " = data not separately available (here taken as zero)
## "-" = nil or zero (make zero)
## "0 0" = more than zero but less than half the unit used (taken to be 0.25)
## F = FAO estimate from available sources of information


(capture_prod <- 
   read_csv(here("data", "raw_data", "fisheries_prod_raw.csv")) %>% 
   clean_names() %>% 
   rename(country = country_country,
          species = species_asfis_species,
          fishing_area = fishing_area_fao_major_fishing_area,
          unit = unit_unit) %>% 
   pivot_longer(names_to = "year", values_to = "value", -c(country, species, fishing_area, unit)) %>% 
   filter(!country %in% c("Totals - Number", "Totals - Tonnes - live weight")) %>% 
   mutate(year = gsub("x", "", year) %>% 
            as.numeric,
          flag = case_when(value == "..." ~ "No data",
                           value == " " ~ "Data not separately available",
                           value == "-" ~ "Nil or zero",
                           value == "0 0" ~ "0<x<0.5",
                           grepl(" F", value) ~ "estimate",
                           TRUE ~ "Reported"), 
          value = case_when(value %in% c("...", " ", "-") ~ "0",
                            value == "0 0" ~ "0.25",
                            grepl(" F", value) ~ gsub(" F", "", value),
                            TRUE ~ value) %>% 
            as.numeric)
)

#sorts country coding to deal with non-UTF characters that country code depends on
Encoding(capture_prod$country) <- "latin1" #deals with the non-UTF
capture_prod$country <- iconv(capture_prod$country, "latin1", "UTF-8",sub='')

capture_prod$iso3c <- countrycode(capture_prod$country, origin = "country.name", destination = "iso3c", warn=TRUE)
capture_prod$iso3c <- case_when(capture_prod$country == "Zanzibar" ~ "TZA",
                                TRUE ~ capture_prod$iso3c)


saveRDS(object = capture_prod, file = here("data", "tidy_data", "capture_production_tidy.rds"))


```


Aquaculture production data
```{r}

(aqua_prod_raw <- read_csv(here("data", "raw_data", "aqua-prod-raw.csv")) %>% 
  clean_names() %>% 
  rename(country= country_country,
         species = species_asfis_species,
         area = aquaculture_area_fao_major_fishing_area,
         environment = environment_environment)
)


#sorts country coding to deal with non-UTF characters that country code depends on
Encoding(aqua_prod_raw$country) <- "latin1" #deals with the non-UTF
aqua_prod_raw$country <- iconv(aqua_prod_raw$country, "latin1", "UTF-8",sub='')



aquaculture_prod <- aqua_prod_raw %>% 
  pivot_longer(names_to = "year", values_to = "value", -c(country, species, area, environment, unit)) %>% 
  mutate(iso_3c = countrycode(country, origin = "country.name", destination = "iso3c", warn = TRUE)) %>%
  mutate(iso_3c = case_when(country == "Zanzibar" ~ "TZA",
                            TRUE ~ iso_3c)) %>% 
    mutate(year = gsub("x", "", year) %>% 
              as.numeric,
           flag = case_when(value == "..." ~ "No data",
                           value == " " ~ "Data not separately available",
                           value == "-" ~ "Nil or zero",
                           value == "0 0" ~ "0<x<0.5",
                           grepl(" F", value) ~ "estimate",
                           TRUE ~ "Reported"),
           value = case_when(value %in% c("...", " ", "-") ~ "0",
                           value == "0 0" ~ "0.25",
                           grepl(" F", value) ~ gsub(" F", "", value),
                           TRUE ~ value) %>% 
              as.numeric) %>% 
   filter(country != "Totals")

  
saveRDS(object = aquaculture_prod, file = here("data", "tidy_data", "aquaculture_production_tidy.rds"))

```


